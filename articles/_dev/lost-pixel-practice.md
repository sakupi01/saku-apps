---
title: "Lost Pixelã¨Github Actionsã‚’ç”¨ã„ãŸVRTã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹"
excerpt: "æ’®å½±ã—ãŸã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’Githubä¸Šã§ç®¡ç†ã—ã€PRä¸Šã§å·®åˆ†æ¤œçŸ¥ã‚’è¡Œã†ã“ã¨ã§ã€æ„å›³ã›ã¬ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã®ãƒ‡ã‚°ãƒ¬ã‚’é˜²ã„ã§ãã‚Œã‚‹Lost Pixelã®å…·ä½“çš„ãªé‹ç”¨æ–¹æ³•ã«ã¤ã„ã¦ã§ã™"
date: "2024-4-21"
beginColor: 'from-cyan-200'
middleColor: 'via-emerald-300'
endColor: 'to-amber-200'
category: 'dev'
tags: ['lost-pixel', 'vrt', 'testing', 'ci/cd']
status: 'published'
---
## ç›®æ¬¡

## ã¯ã˜ã‚ã«
2æœˆã«é–‹å‚¬ã•ã‚ŒãŸ[#vrt4é¸](https://twitter.com/hashtag/VRT4%E9%81%B8)ã¨ã„ã†å‹‰å¼·ä¼šã«å‚åŠ ã—ãŸéš›ã€ãã®ä¸­ã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸLost Pixelã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã«èˆˆå‘³ã‚’æŒã¡ã¾ã—ãŸã€‚

â€»OSSãƒ¢ãƒ¼ãƒ‰ã§ã‚‚githubã§ç®¡ç†ã™ã‚Œã°å·®åˆ†ã‚’è¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ãã—ã¦ãã‚Œã‚‹
â€»pixcelâ†’pixelã­ï¼ï¼
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">Lost Pixcelã€OSSãƒ¢ãƒ¼ãƒ‰å‰æã ã¨UIã®å·®åˆ†ãŒè¦‹ãŸç›®ã§æ¤œçŸ¥ã—ã«ãã„ä»¥å¤–ã‚ã¡ã‚ƒãã¡ã‚ƒé­…åŠ›çš„ã‹ã‚‚<br>å€‹äººé–‹ç™ºã§Tryã—ã¦ã¿ãŸã¿ãŒã‚ã‚‹<a href="https://twitter.com/hashtag/VRT4%E9%81%B8?src=hash&amp;ref_src=twsrc%5Etfw">#VRT4é¸</a></p>&mdash; saku (@SakuOnTheWeb) <a href="https://twitter.com/SakuOnTheWeb/status/1760260787078357477?ref_src=twsrc%5Etfw">February 21, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

ğŸ‘‡è©²å½“ã®ã‚¹ãƒ©ã‚¤ãƒ‰

https://speakerdeck.com/aiji42/vrtturunodakuhosu-lost-pixelwoshao-jie-sitai

æ™®æ®µã¯å°‚ã‚‰[Chromatic](https://www.chromatic.com/)ãƒ¦ãƒ¼ã‚¶ãªã®ã§ã™ãŒã€å€‹äººé–‹ç™ºã®éš›ç„¡æ–™æ ã®ä¸Šé™ã«ãƒ’ãƒƒãƒˆã—ã¦ç—›ã„ç›®ã«ã‚ã£ãŸéå»ãŒã‚ã‚‹ã®ã§ã€ä»Šå›å€‹äººãƒ–ãƒ­ã‚°ã§ã¯Lost Pixelã§VRTã‚’è¡Œã†ã“ã¨ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

[#vrt4é¸](https://twitter.com/hashtag/VRT4%E9%81%B8)ã§ã¯è©³ç´°ãªå®Ÿè£…ã‚„VRTã®ä¸€é€£ã®æµã‚Œã¾ã§è¿°ã¹ã‚‰ã‚Œã¦ã„ãªã‹ã£ãŸã‹ã¤ã€ã¾ã å›½å†…ã§ã‚ã¾ã‚Šæ™®åŠã—ã¦ãŠã‚‰ãšã€ç™ºè¡¨è€…ã®æ–¹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ä»¥å¤–ã§æ—¥æœ¬èªæ–‡çŒ®ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€ä»Šå›ã¯Lost Pixelã‚’ç”¨ã„ãŸå…·ä½“çš„ãªVRTã®é‹ç”¨æ–¹æ³•ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

## å‰æ
å‰æã¨ã—ã¦ã€ã“ã®ãƒ–ãƒ­ã‚°ã¯`/apps/blog`ã«Next.jsè£½ã®ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªã‚’å«ã‚€ãƒ¢ãƒãƒªãƒæ§‹æˆã§ã§ãã¦ã„ã¾ã™ã€‚

https://www.skr-blog.com/dev/articles/blog-tech-stack


ä»Šå›ã¯ã“ã®`apps/blog`(ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªéƒ¨åˆ†)ã«Lost Pixelã‚’ç”¨ã„ãŸVRTã‚’æ–½ã—ã¦ã„ãã¾ã™ã€‚

### Lost Pixelã¨ã¯
Lost Pixelã¨ã¯ã€VRT(Visual Regression Test, ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å›å¸°ãƒ†ã‚¹ãƒˆ)ã‚’è¡Œã†ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://www.lost-pixel.com/

ç°¡å˜ã«ã€VRTã¨ã¯ã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã®å‰å¾Œã§ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«çš„ãªï¼ˆã“ã“ã§ã¯Web UIã«å¯¾ã—ã¦ï¼‰æ„å›³ã›ã¬å¤‰åŒ–ãŒç”Ÿã˜ã¦ã„ãªã„ã‹ã‚’æ¤œçŸ¥ã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚

VRTã¯Unitãƒ†ã‚¹ãƒˆã‚„Integrationãƒ†ã‚¹ãƒˆã‚’ä»£æ›¿ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ã“ã‚Œã‚‰ã®ãƒ†ã‚¹ãƒˆã«åŠ ãˆã¦ã€äººé–“ãŒç›®è¦–ã§èªè­˜ã—ã«ãã„éƒ¨åˆ†ã®ãƒ‡ã‚°ãƒ¬ã§ã‚‚ã€æ©Ÿæ¢°çš„ã«è‡ªå‹•ã§è¦‹ãŸç›®ã®æ­£å½“æ€§ã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚

VRTã«é–¢ã™ã‚‹ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜ã¯ä»¥ä¸‹ã‚’å‚ç…§ãã ã•ã„ã€‚

https://www.lost-pixel.com/blog/visual-regression-testing-101

VRTã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Chromatic, storycapã§ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ+reg-suitã§ã®å·®åˆ†æ¯”è¼ƒ**ãªã©**ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ãŒã€Lost Pixelã®OSSãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç§ãŒã“ã‚Œã¾ã§ä½¿ç”¨ã—ãŸç¯„å›²ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ©ç‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚

â­ï¸ãƒ¡ãƒªãƒƒãƒˆ
- OSSãƒ¢ãƒ¼ãƒ‰ã ã¨ã€Githubã‚’ãƒ•ãƒ«æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ç„¡æ–™ã§VRTã§ãã‚‹åŸºç›¤ãŒä½œã‚Œã‚‹
- Storybookã‚„Ladle, Histoire, ãƒšãƒ¼ã‚¸å˜ä½ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€Cypressã‚„Playwrightã‚’ç”¨ã„ãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãªã©æ§˜ã€…ãªæ’®å½±æ–¹æ³•ãŒå¯èƒ½
- VRTã§ã®å·®åˆ†ãƒã‚§ãƒƒã‚¯ã‚’GIthubã§ã®PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã«çµ„ã¿è¾¼ã‚ã‚‹
- ãƒã‚¹ã‚­ãƒ³ã‚°æ©Ÿèƒ½ãŒã‚ã‚Šã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒé›£ã—ã„ãƒ©ãƒ³ãƒ€ãƒ ãªè¦ç´ ã‚’å·®åˆ†ãƒã‚§ãƒƒã‚¯ã‹ã‚‰é™¤å¤–ã§ãã€æœ¬è³ªçš„ãªéƒ¨åˆ†ã®æ¤œè¨¼ãŒå®¹æ˜“
- ã‚ºãƒ¬ã®é–¾å€¤ã‚„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹ã¾ã§ã®å¾…æ©Ÿæ™‚é–“ã€networkRequestã‚„ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’ç´°ã‹ãè¨­å®šã§ãã‚‹
- configãƒ•ã‚¡ã‚¤ãƒ«ãŒTypeScriptã§æ›¸ã‘ã‚‹

é‡è¤‡ã—ãŸèª¬æ˜ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ç°¡å˜ãªèª¬æ˜ã«æ­¢ã‚ã¦è©³ç´°ã¯[ã‚¹ãƒ©ã‚¤ãƒ‰](https://speakerdeck.com/aiji42/vrtturunodakuhosu-lost-pixelwoshao-jie-sitai)ã‚„[Zennã®è¨˜äº‹](https://zenn.dev/aiji42/articles/6656072a954a9b)ã«è­²ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ãƒšãƒ¼ã‚¸å˜ä½ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ãŸã‚ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®Page shotséƒ¨åˆ†ã‚’å‚ç…§ã—ã¾ã™ã€‚

https://docs.lost-pixel.com/user-docs/setup/project-configuration/modes#page-shots

ãƒ™ãƒ¼ã‚¹ã¯ä¸Šè¨˜ã®é€šã‚Šã§ã™ãŒã€ä»Šå›ã¯ãƒ¢ãƒãƒªãƒã‹ã¤CIã®ä½¿ç”¨ã¨ã„ã†ã“ã¨ã‚’åŠ å‘³ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã‚’åŠ ãˆã¦ã„ã¾ã™ã€‚

<details>

```ts showLineNumbers {7} title="lostpixel.config.ts"
import { CustomProjectConfig } from "lost-pixel";

export const config: CustomProjectConfig = {
  pageShots: {
    pages: [
      { path: "/", name: "home" },
      { path: "/about", name: "about" },
      { path: "/dev", name: "dev" },
      { path: "/dev/articles/blog-tech-stack", name: "blog-tech-stack" },
      { path: "/dev/tag/react", name: "tag-react" },
      {
        path: "/life", // ğŸŸ¢ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹ãƒšãƒ¼ã‚¸ã®path
        name: "life", // ğŸŸ¢ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®åå‰
        threshold: 0.004, // ğŸŸ¢é–¾å€¤ã€‚ã©ã®ãã‚‰ã„ã®ã‚ºãƒ¬ã¾ã§è¨±å®¹ã™ã‚‹ã‹
        mask: [{ selector: ".eye-catch" }], // ğŸŸ¢ãƒã‚¹ã‚¯ã‚’ã‹ã‘ã‚‹ã‚»ãƒ¬ã‚¯ã‚¿
      },
      {
        path: "/life/articles/intern-completed-aritcle",
        name: "intern-completed-article",
        mask: [{ selector: ".thumbnail" }],
      },
      {
        path: "/life/tag/poem",
        name: "poem",
        threshold: 0.006,
        mask: [{ selector: ".eye-catch" }],
      },
    ],
    // ğŸŸ¢ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ã¨ãã®IPã¯localhostã§ã€Github Actionã§å®Ÿè¡Œã™ã‚‹ã¨ãã®IPã¯172.17.0.1ã«è¨­å®šã™ã‚‹
    baseUrl: process.env.LOCAL
      ? "http://localhost:3000"
      : "http://172.17.0.1:3000",
  },
  waitBeforeScreenshot: 5000,// ğŸŸ¢
  timeouts: {
    loadState: 50000, // ğŸŸ¢
    networkRequests: 50000, // ğŸŸ¢
  },
  
  // OSS mode
  // ğŸŸ¢ãƒ¢ãƒãƒªãƒã®å ´åˆã€Github Actionã§å®Ÿè¡Œã™ã‚‹ã¨ãã®ãƒ‘ã‚¹ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®rootã‹ã‚‰ã®ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹
  imagePathBaseline: process.env.LOCAL // ğŸŸ¢baselineã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ ¼ç´å…ˆã€‚ã“ã“ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒæ¯”è¼ƒåŸºæº–
    ? "./tests/vrt/baseline-images"
    : "./apps/blog/tests/vrt/baseline-images",
  imagePathCurrent: process.env.LOCAL // ğŸŸ¢currentã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ ¼ç´å…ˆã€‚ç¾çŠ¶ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã§ã€baselineã¨æ¯”è¼ƒã•ã‚Œã‚‹
    ? "./tests/vrt/current-images"
    : "./apps/blog/tests/vrt/current-images",
  imagePathDifference: process.env.LOCAL // ğŸŸ¢differenceã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ ¼ç´å…ˆã€‚currentImageã¨baselineImageã®å·®åˆ†ç”»åƒ
    ? "./tests/vrt/difference-images"
    : "./apps/blog/tests/vrt/difference-images",
  generateOnly: true,

  // ğŸŸ¢baselineã¨currentã«å·®åˆ†ãŒã‚ã‚‹æ™‚ã¯å®Ÿè¡Œçµæœã‚’failã¨ã—ã¦ãƒãƒ¼ã‚¯
  failOnDifference: true,
};
```
</details>


## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é©ç”¨

### é‹ç”¨ã‚·ãƒŠãƒªã‚ª
æ—©é€Ÿã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«Lost Pixelã‚’é©ç”¨ã—ã¦ã„ãæ‰‹é †ã‚’è¦‹ã¦ã„ãã¾ã™ğŸ‘€

ã¾ãšã€ä»Šå›ã®é‹ç”¨ã‚·ãƒŠãƒªã‚ªã¯ä»¥ä¸‹ã¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

- ãƒ¢ãƒãƒªãƒã®`apps/blog`ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾ã—ã¦ã€**ãƒšãƒ¼ã‚¸å˜ä½ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**ã‚’æ’®ã‚‹ã“ã¨ã§UIå·®åˆ†æ¯”è¼ƒ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’`main`, Lost Pixelã‚’å–ã‚Šå…¥ã‚Œã‚‹ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒã‚’`feat/lost-pixel`ã¨ã™ã‚‹
- featureãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ã®PRãƒã‚§ãƒƒã‚¯æ™‚ã«Github Actionsã§Lost Pixel OSSãƒ¢ãƒ¼ãƒ‰ã‚’ç”¨ã„ãŸVRTã‚’è¡Œã†
- å·®åˆ†ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã¯`/update-vrt`ã¨PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®æ›´æ–°PR`lost-pixel-update/[base-pr-name]`ã‚’å…ƒãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ã‹ã‚‰æ–°ãŸã«ä½œæˆã™ã‚‹
- `lost-pixel-update/[base-pr-name]`ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®å·®åˆ†ã‚’Image Diffã‚’ç”¨ã„ã¦ç¢ºèªãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€ãƒãƒ¼ã‚¸ã™ã‚‹
- å…ƒãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ä¸Šã§VRTãŒå†åº¦èµ°ã‚Šã€ãƒã‚§ãƒƒã‚¯ãŒpassã™ã‚‹

ãŠãŠã¾ã‹ãªæµã‚Œã‚’æ´ã‚“ã ã¨ã“ã‚ã§ã€å®Ÿéš›ã«æ‰‹é †ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ğŸ‹ğŸ»

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèª
#### 0. ãƒ­ãƒ¼ã‚«ãƒ«ã§å·®åˆ†ç¢ºèªã™ã‚‹
`package.json`ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚
[ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—]()ã§è¨­å®šã—ãŸ`lostpixel.config.ts`ã®å†…å®¹ã‚’ã‚ˆãè¦‹ã‚‹ã¨ã€ç’°å¢ƒå¤‰æ•°ã®å€¤ã«ã‚ˆã£ã¦è¨­å®šå€¤ã‚’å¤‰ãˆã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹ã®ã§ã€ãã“ã‚’åŠ å‘³ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã—ã¾ã™ã€‚

```json showLineNumbers {5, 6} title="./apps/blog/package.json"
{
    ...
    "scripts": {
        ...,
        "lost-pixel": "LOCAL=true lost-pixel",
        "lost-pixel:update": "LOCAL=true lost-pixel update",
        ...
    }
    ...
}
```
ä¸Šè¨˜ã®ã‚ˆã†ã«`LOCAL=true`ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€npm scriptsã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã®ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã§ã€CIã§ã¯[lost-pixelã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³](https://github.com/lost-pixel/lost-pixel)ã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã€ã“ã®scriptsã®LOCALç’°å¢ƒå¤‰æ•°ã¯`true`ã«è¨­å®šã—ã¦ãŠã„ã¦å•é¡Œãªã„ã§ã™ã€‚


ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€æ‰‹å…ƒã®ç’°å¢ƒã§å·®åˆ†ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ã‚ãŸã—ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```bash
$ bun lost-pixel
```
![lost-pixelåˆå›å®Ÿè¡Œ](/first-execution.png)
*lost-pixelåˆå›å®Ÿè¡Œã®å‡ºåŠ›*

#### 1. baselineã‚’updateã™ã‚‹
ã¨ã“ã‚ãŒã€åˆã‚ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ã€Œbaselineã®ã‚¹ã‚¯ã‚·ãƒ§ãŒãªã„ã‹ã‚‰æ¯”è¼ƒã§ããªã„ã‚ˆã€œã€ã®ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

```bash {6, 8, 10, 13, 14}
Screenshots done!
Creating shots took 20.902 seconds
ğŸ” Checking differences
Comparing 8 screenshots using 'pixelmatch' as compare engine
[1/8] Comparing 'home' (home)
[1/8] Baseline image missing. Will be treated as addition. (home)
[2/8] Comparing 'about' (about)
[2/8] Baseline image missing. Will be treated as addition. (about)
[3/8] Comparing 'dev' (dev)
[3/8] Baseline image missing. Will be treated as addition. (dev)
...
Comparison done!
ğŸ‘‹ Exiting process with 0 found differences & 8 baselines to update
Sending anonymized telemetry data.
error: script "lost-pixel" exited with code 1
```

ãªã®ã§ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ãªã‚‹ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã€æ¯”è¼ƒåŸºæº–ã‚’ç”Ÿæˆã—ã¦ã‚ã’ã¾ã™ã€‚

```bash
$ bun lost-pixel:update
```
ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«baseline-imagesã«ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚
![ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒãŒç”Ÿæˆã•ã‚Œã‚‹](/baseline-gen.png)
*ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒãŒç”Ÿæˆã•ã‚Œã‚‹*

ã—ã‹ã—ã€baseline-imagesã¨current-imagesã®æ¯”è¼ƒãŒãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚ˆã‚Šã‚‚å…ˆã«è¡Œã‚ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã‹ã€ã¾ãŸã‚‚ã‚„ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚
```bash {12, 13}
Screenshots done!
Creating shots took 13.659 seconds
ğŸ” Checking differences
Comparing 8 screenshots using 'pixelmatch' as compare engine
[1/8] Comparing 'home' (home)
[1/8] Baseline image missing. Will be treated as addition. (home)
[2/8] Comparing 'about' (about)
[2/8] Baseline image missing. Will be treated as addition. (about)
...
Comparison done!
Removing 0 files from ./tests/vrt/baseline-images
ğŸ‘‹ Exiting process with 0 found differences & 8 baselines to update
Sending anonymized telemetry data.
error: script "lost-pixel:update" exited with code 1
```

#### 2. ã‚‚ã†ä¸€åº¦å·®åˆ†ç¢ºèªã‚’ã™ã‚‹
ã¨ã¯ã„ãˆã€base-imagesã®æ›´æ–°ã¯ã§ãã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€ã‚‚ã†ä¸€åº¦å·®åˆ†ã®ç¢ºèªã‚’ã—ã¾ã™ã€‚
```bash
$ bun lost-pixel
```
ã™ã‚‹ã¨ã€ä»Šå›ã¯ä¾‹å¤–ã¯ã‚¹ãƒ­ãƒ¼ã•ã‚Œãšã«ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸğŸ‰
```bash {9, 10, 11}
Screenshots done!
Creating shots took 12.356 seconds
ğŸ” Checking differences
Comparing 8 screenshots using 'pixelmatch' as compare engine
[1/8] Comparing 'home' (home)
[2/8] Comparing 'about' (about)
[3/8] Comparing 'dev' (dev)
...
[1/8] No difference found. (home)
[2/8] No difference found. (about)
[3/8] No difference found. (dev)
...
Comparison done!
â±  Checking differences took 0.014 seconds
â±  Lost Pixel run took 12.371 seconds
Sending anonymized telemetry data.
```
ã“ã®æµã‚Œã‚’CIä¸Šã§ã‚‚ãŠã“ãªã„ã€PRãƒãƒ¼ã‚¸ã®éš›ã«è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãã¾ã—ã‚‡ã†ğŸŒğŸ»â€â™€ï¸

### é‹ç”¨ã®æº–å‚™
#### 3. Workflowã‚’ä½œæˆã™ã‚‹
Github Actionsã‚’ç”¨ã„ã¦CIã¨ã—ã¦å‹•ã‹ã™ãŸã‚ã®Workflowãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

[é‹ç”¨ã‚·ãƒŠãƒªã‚ª]()ã§è¿°ã¹ãŸä»¥ä¸‹ã®æµã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€æ¬¡ã‹ã‚‰ã®é …ç›®ã§`vis-reg-test.yml`ã¨`update-lostpixel.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚
> - featureãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ã®PRãƒã‚§ãƒƒã‚¯æ™‚ã«Github Actionsã§Lost Pixel OSSãƒ¢ãƒ¼ãƒ‰ã‚’ç”¨ã„ãŸVRTã‚’è¡Œã†
> - å·®åˆ†ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã¯`/update-vrt`ã¨PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®æ›´æ–°PR`lost-pixel-update/> [base-pr-name]`ã‚’å…ƒãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ã‹ã‚‰æ–°ãŸã«ä½œæˆã™ã‚‹
> - `lost-pixel-update/[base-pr-name]`ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®å·®åˆ†ã‚’Image Diffã‚’ç”¨ã„ã¦ç¢ºèªãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€ãƒãƒ¼ã‚¸ã™ã‚‹
> - å…ƒãƒ–ãƒ©ãƒ³ãƒ`feat/lost-pixel`ä¸Šã§VRTãŒå†åº¦èµ°ã‚Šã€ãƒã‚§ãƒƒã‚¯ãŒpassã™ã‚‹

ï¼ˆP.S. ã“ã®CI workflowã‚’ä½œæˆã™ã‚‹ã®ã«å¤šãã®æ™‚é–“ã‚’æ¶ˆè²»ã—ã¾ã—ãŸã€‚ç§ã¯CIã«ã¨ã¦ã‚‚å¼±ã„ã§ã™ã€‚ï¼ˆCIã‚¹ãƒ‘ã‚¹ãƒ‘ä½œã‚Œã‚‹äººã€…ã‹ã£ã“ã„ã„ã€‚ã€‚ã€‚ï¼‰ï¼‰

##### 3.1 å·®åˆ†ç¢ºèªã®ãŸã‚ã®Workflow(vis-reg-test.yml)
`vis-reg-test.yml`ã®å½¹å‰²ã¯[lost-pixel/lost-pixelã¨ã„ã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³](https://github.com/lost-pixel/lost-pixel)ã‚’åˆ©ç”¨ã—ãŸå˜ç´”ãªå·®åˆ†ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã®å†…å®¹ã¯`# ğŸŸ¢...`ã§ç¤ºã—ã¦ã„ã¾ã™ã€‚

<details>

```yaml showLineNumbers {7} title="vis-reg-test.yml"
name: Visual Regression Test

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}
    steps:ã€€# ğŸŸ¢ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      - name: Checkout Commit
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install

      - name: Cache bun dependencies
        uses: actions/cache@v3
        id: bun-cache
        with:
          path: node_modules
          key: ${{ runner.os }}-bun-${{ hashFiles('**/bun.lockb') }}
          restore-keys: ${{ runner.os }}-bun
  lost-pixel:
    needs: build
    runs-on: ubuntu-latest
    strategy:
        matrix: 
          config:
            # ğŸŸ¢ å°†æ¥çš„ã«VRTã—ãŸã„ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒå¢—ãˆãŸã‚‰ã“ã“ã«è¿½åŠ ã™ã‚‹
            - {
                package: "apps/blog",
                name: "Lost Pixel for blog page",
                command: "bun run start",
              }
    
    # ğŸŸ¢stepãŒåˆ©ç”¨ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¸Šè¨˜${{ matrix.config.package }}ã®å€¤ã«ã™ã‚‹
    defaults: 
        run:
            working-directory: ${{ matrix.config.package }}
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}
    steps:
      - name: Checkout Commit
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
      
      # ğŸŸ¢.envã‚’ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’ç™»éŒ²ã™ã‚‹
      - name: Create .env file 
        run: |
            touch .env
            echo "ZENN_URL=${{ secrets.ZENN_URL }}" >> .env
            echo "ZENN_BASE_URL=${{ secrets.ZENN_BASE_URL }}" >> .env

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Restore bun dependencies
        id: bun-cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-bun-${{ hashFiles('**/bun.lockb') }}
          restore-keys: ${{ runner.os }}-bun
      
      - name: Build UI
        working-directory: ./packages/ui
        run: bun run build 

      # ğŸŸ¢ ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰
      - name: Build App
        run: cd ../../ && bun run build 

      # ğŸŸ¢ ã‚µãƒ¼ãƒã®ç«‹ã¡ä¸Šã’ã€‚ã‚³ãƒãƒ³ãƒ‰ã¯${{ matrix.config.command }}ã®å€¤ã‚’åˆ©ç”¨
      - name: Start App
        run: cd . && ${{ matrix.config.command }} &
       
       # ğŸŸ¢ Lost Pixelã‚’ç”¨ã„ãŸVRT
      - name: Lost Pixel
        id: lostpixel
        uses: lost-pixel/lost-pixel@v3.16.0
        env:
            LOST_PIXEL_DISABLE_TELEMETRY: 1
            LOST_PIXEL_CONFIG_DIR: ${{ matrix.config.package }}
```
</details>

##### 3.2 baselineæ›´æ–°ã®ãŸã‚ã®Workflow(update-vrt.yml)
<details>

```yaml showLineNumbers {7} title="update-vrt.yml"
# ğŸŸ¢ https://zenn.dev/aiji42/articles/6656072a954a9b ã‚’å¤§å¤‰å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼ğŸ™‡ğŸ»
name: Visual Regression Testing Update By PR Comment

on:
  issue_comment:
    types: [created, edited]

jobs:
  lost-pixel:
  # ğŸŸ¢ PRã«`/update-vrt`ã¨ã„ã†æ–‡å­—åˆ—ã‹ã‚‰å§‹ã¾ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆãŒcreate OR editã•ã‚ŒãŸã‚‰ã‚¸ãƒ§ãƒ–ãŒã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹
    if: contains(github.event.comment.html_url, '/pull/') && startsWith(github.event.comment.body, '/update-vrt')
    name: ğŸ“¸ Lost Pixel Baseline Update By PR Comment
    runs-on: ubuntu-latest
    env:
      TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
      TURBO_TEAM: ${{ vars.TURBO_TEAM }}
    
    # ğŸŸ¢ GIthub Actionsã«PRã®ä½œæˆã®ãŸã‚ã®æ¨©é™ã‚’ä»˜ä¸
    permissions:
      contents: write
      pull-requests: write
    
    # ğŸŸ¢ ãƒ¢ãƒãƒªãƒã®å„ã‚µãƒ¼ãƒ“ã‚¹ã§é‹ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®š
    strategy:
      matrix:
        config: 
          - { package: "apps/blog", name: "Lost Pixel for blog page", command: "bun run start" }
    
    # ğŸŸ¢ stepãŒåˆ©ç”¨ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¸Šè¨˜${{ matrix.config.package }}ã®å€¤ã«ã™ã‚‹
    defaults:
      run:
        working-directory: ${{ matrix.config.package }}

    steps:
      # ğŸŸ¢ stepãŒåˆ©ç”¨ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¸Šè¨˜${{ matrix.config.package }}ã®å€¤ã«ã™ã‚‹
      - name: Get branch name
        uses: xt0rted/pull-request-comment-branch@v2
        id: comment-branch
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}

      # ğŸŸ¢ æŒ‡å®šã®ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹
      - name: Checkout Commit
        uses: actions/checkout@v3
        with:
          ref: ${{ steps.comment-branch.outputs.head_ref }}
          fetch-depth: 0

      # ğŸŸ¢ .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹        
      - name: Create .env file
        run: |
              touch .env
              echo "ZENN_URL=${{ secrets.ZENN_URL }}" >> .env
              echo "ZENN_BASE_URL=${{ secrets.ZENN_BASE_URL }}" >> .env

      # ğŸŸ¢ Gitã®è¨­å®šã‚’è¡Œã†
      - name: Setup Git User
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'github-actions@github.com'

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      # ğŸŸ¢ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
      - name: Install dependencies
        run: cd ../../ && bun install

      - name: Build UI
        working-directory: ./packages/ui
        run: bun run build

      # ğŸŸ¢ ãƒ–ãƒ­ã‚°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹
      - name: Build App
        run: cd ../../ && bun run build

      # ğŸŸ¢ ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹
      - name: Start App
        run: cd . && ${{ matrix.config.command }} &

      # ğŸŸ¢ Lost Pixelã‚’ä½¿ç”¨ã—ã¦ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’æ›´æ–°ã™ã‚‹
      # ğŸŸ¢ (point)æ¯”è¼ƒã¯ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°å‰ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã€å¿…ãšä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹
      - name: Lost Pixel Update
        id: lostpixel
        uses: lost-pixel/lost-pixel@v3.16.0
        env:
          LOST_PIXEL_MODE: update
          LOST_PIXEL_DISABLE_TELEMETRY: 1
          LOST_PIXEL_CONFIG_DIR: ${{ matrix.config.package }}

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # ğŸŸ¢ ä¸€åº¦VRTã‚’å›ã—ã¦ã€Successã‚’ç¢ºèªã™ã‚‹ã¨ã¨ã‚‚ã«difference-imagesã‚’ç©ºã«ã™ã‚‹
      # ğŸŸ¢ baseline-imagesã‚’æ›´æ–°ã—ã¤ã¤ã€difference-imagesã‚’ç©ºã«ã—ãŸçŠ¶æ…‹ã§PRã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã‚‚ã€ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯å¿…è¦
      - name: Lost Pixel
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' }}
        uses: lost-pixel/lost-pixel@v3.16.0
        env:
          LOST_PIXEL_DISABLE_TELEMETRY: 1
          LOST_PIXEL_CONFIG_DIR: ${{ matrix.config.package }}

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # ğŸŸ¢ git add ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦æ¨©é™ã‚’ä¸ãˆã‚‹
      - name: Give Permission to untracked files
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' }}
        run: sudo chown -R $USER:$USER .
      
      # ğŸŸ¢ æ—¢å­˜ã®Lost Pixel PRãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹
      - name: Check existing Lost Pixel PR
        id: check-pr
        run: |
          existing_pr=$(gh pr list --base ${{ steps.comment-branch.outputs.head_ref }} --label update-lost-pixel --json number,head.ref --jq '.[] | select(.head.ref | startswith("lost-pixel-update/")) | .number')
          echo "::set-output name=pr_number::$existing_pr"

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # ğŸŸ¢ æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã‚’ä½œæˆã™ã‚‹
      - name: Create new branch
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' && steps.check-pr.outputs.pr_number == '' }}
        run: |
          git checkout -b lost-pixel-update/${{ steps.comment-branch.outputs.head_ref }}

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # ğŸŸ¢ æ—¢å­˜ã®PRãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã«ã„ã
      - name: Checkout existing PR branch
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' && steps.check-pr.outputs.pr_number != '' }}
        run: |
          git checkout lost-pixel-update/${{ steps.comment-branch.outputs.head_ref }}

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã«
      # ğŸŸ¢ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹
      - name: Add untracked files
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' }}
        run: |
          git add .

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã«
      # ğŸŸ¢ ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
      - name: Create commit
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' }}
        run: |
          git commit -m "Update VRT baseline images" || echo "No changes to commit"

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã«
      # ğŸŸ¢ å¤‰æ›´ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
      - name: Push changes
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' }}
        run: |
          git push origin HEAD:lost-pixel-update/${{ steps.comment-branch.outputs.head_ref }} --force

      # â˜‘ï¸ Lost Pixel Updateã§ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®å ´åˆ
      # æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒ(lost-pixel-update/[`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒå])ã®
      # ğŸŸ¢ PRã‚’`/update-vrt`ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã—ã¦ä½œæˆã™ã‚‹
      - name: Create Pull Request
        if: ${{ failure() && steps.lostpixel.conclusion == 'failure' && steps.check-pr.outputs.pr_number == '' }}
        run: |
          gh pr create --base ${{ steps.comment-branch.outputs.head_ref }} \
                       --head lost-pixel-update/${{ steps.comment-branch.outputs.head_ref }} \
                       --label update-lost-pixel \
                       --title 'Lost Pixel Update
```
</details>

#### 4. update-vrt.ymlã‚’mainãƒ–ãƒ©ãƒ³ãƒã«å–ã‚Šè¾¼ã‚€


#### 5. `feat/lost-pixel`ã®PRã‚’ä½œæˆã™ã‚‹

### é‹ç”¨ã™ã‚‹

#### 6. vis-reg-test.ymlã‚’å›ã™

##### 6.1 Failã®ã¨ã 
`/update-vrt`ã¨PRã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚ã™ã‚‹ã¨ã€å…ˆã»ã©å®šç¾©ã—ãŸ`update-vrt.yml`ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

:::note{.warning}
â— Warning
<br/>
issue_commentã¯ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ã¡ãƒ¼ãƒ¼ãƒ¼
:::

ã“ã‚Œã«ã‚ˆã‚Šã€baselineã®updateã‚’ã™ã‚‹ãŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒ`lost-pixel-update/[base-pr-name]`ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥ã‚ŒãŸPR(ã“ã“ã§ã¯`feat/lost-pixel`)ã‹ã‚‰ç”Ÿãˆã‚‹å½¢ã§ä½œæˆã•ã‚Œã€ã‚¿ã‚¤ãƒˆãƒ«ãŒã€ŒLost Pixel Update - [base-branch-name]ã€PRã‚‚ä½œæˆã•ã‚Œã¾ã™ã€‚

ã“ã“ã§ã€ä½œæˆã•ã‚ŒãŸPRã®Changeséƒ¨åˆ†ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€Githubä¸Šã§è¦–è¦šçš„ã«è¦‹ãŸç›®ã®å¤‰åŒ–ã‚’æ‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ğŸ‘‡å¾®ã€…ãŸã‚‹å¤‰åŒ–ã€‚ã“ã®å ´åˆã€ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„å®Ÿè¡Œç’°å¢ƒã®å·®ç•°ãŒåŸå› ã§ã‚ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚

â†’[ã‚¹ãƒ†ãƒƒãƒ—6.1.1ã¸]()


ğŸ‘‡è¦‹ãŸç›®ã®å¤§ããªå¤‰åŒ–ã€‚ã“ã®å ´åˆã€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ä½•ã‚‰ã‹ã®å•é¡ŒãŒã‚ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚

â†’[ã‚¹ãƒ†ãƒƒãƒ—6.1.2ã¸]()

<br />

###### 6.1.1 è¨±å®¹å¯èƒ½ãªè¦‹ãŸç›®ã®å¤‰åŒ–ã®ã¨ã
PRã®å·®åˆ†ã‚’ç¢ºèªã—ãŸçµæœã€è¨±å®¹å¯èƒ½ãªè¦‹ãŸç›®ã®å¤‰åŒ–ã®æ™‚ã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒ(`feat/lost-pixel`)ã®baselineã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸã„ã§ã™ã€‚
ãã†ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒ(`feat/lost-pixel`)ã§ã‚‚ã†ä¸€åº¦`vis-reg-test.yml`ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å›ã—ã¦ãƒ†ã‚¹ãƒˆã‚’passã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚

ãªã®ã§ã€`lost-pixel-update/[base-pr-name]`ãƒ–ãƒ©ãƒ³ãƒã®ã€ŒLost Pixel Update - [base-branch-name]ã€PRã‚’ãƒãƒ¼ã‚¸ã—ã¾ã—ã‚‡ã†ï¼

ã™ã‚‹ã¨ã€ã‚³ãƒ¡ãƒ³ãƒˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒ(`feat/lost-pixel`)ã§ã‚‚ã†ä¸€åº¦`vis-reg-test.yml`ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå‘¨ã‚Šã€ä»Šåº¦ã¯updateã•ã‚ŒãŸbaselineã¨ã®æ¯”è¼ƒãŒè¡Œã‚ã‚Œã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆã‚’passã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

â†’[ã‚¹ãƒ†ãƒƒãƒ—6.2ã¸]()

<br />

###### 6.1.2 è¨±å®¹ä¸å¯èƒ½ãªè¦‹ãŸç›®ã®å¤‰åŒ–ã®ã¨ã
ã‚³ãƒ¡ãƒ³ãƒˆå…ƒã®ãƒ–ãƒ©ãƒ³ãƒ(`feat/lost-pixel`)ã«æˆ»ã£ã¦ã€è¦‹ãŸç›®ã‚’æƒãˆã‚‹ãŸã‚ã®ä¿®æ­£ã‚³ãƒŸãƒƒãƒˆã‚’åŠ ãˆã€å†åº¦pushã—ã¾ã™ã€‚

â†’[ã‚¹ãƒ†ãƒƒãƒ—6ã¸]()

##### 6.2 Successã®ã¨ã
ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã“ã‚Œã§è¦‹ãŸç›®ãŒç¢ºèªã•ã‚ŒãŸå¤‰æ›´ã‚’ãƒãƒ¼ã‚¸ã§ãã¾ã™ğŸ’¯

### æœªè§£æ±ºéƒ¨åˆ†
ä»Šå›ã€Next.js v14ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€`next-font`ã‚’ç”¨ã„ã¦ãƒ•ã‚©ãƒ³ãƒˆã®æœ€é©åŒ–ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

playwrightã¨mswã®æ›ã‘åˆã‚ã›ï¼Ÿ

Lost Pixelã¯ã€å†…éƒ¨çš„ã«Playwrightã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’ã—ã¦ã„ã¾ã™ã€‚

### ã¾ã¨ã‚
```json showLineNumbers {7} title="turbo.json"
{
    "$schema": "https://turbo.build/schema.json",
    "globalDependencies": ["**/.env.*local"],
    "pipeline": {
        "build": {
            "dependsOn": ["^build"],
            "outputs": [".next/**", "!.next/cache/**"]
        },
        "test": {
            "dependsOn": ["^build"]
        },
        ...
    }
    ...
}
```
